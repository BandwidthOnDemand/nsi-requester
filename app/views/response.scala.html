@(request: String, response: String)(implicit httpRequest: Request[AnyContent])

@import helper._

@main("NSI Responses", "response") {
    <section>
        <h1>NSI Responses</h1>
        <div class="content">
            @xmlBlock("The Response", response)
            @xmlBlock("The Request", request)
        </div>
        <div id="template" class="template">
            @xmlBlock("Callback Response", "")
        </div>
    </section>

    <script>
      $(function() {
          var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket
          var socket = new WS("ws://@{httpRequest.host + routes.Application.wsRequest}");

          var appendTime = function(xmlBlock) {
            var now = new Date();
            var nowString = now.getHours()+':'+now.getMinutes()+':'+now.getSeconds();
            xmlBlock.find("h3").append($("<span/>", {"class": "time", text: nowString}));
          }

          socket.onmessage = function(event) {
            xmlBlock = $("#template > div").clone();
            xmlBlock.find(".prettyprint").text(event.data);
            appendTime(xmlBlock);
            xmlBlock.prependTo("section .content");
            prettyPrint();
          }
          socket.onopen = function(event) { console.log("socket is open"); }
          socket.onclose = function(event) { console.log("socket closed..") }

          appendTime($(".content > .xml-content"))
      })
    </script>
}

@xmlBlock(title: String, content: String) = {
    <div class="xml-content">
        <div class="message"><h3>@title</h3></div>
        <pre class="prettyprint">@content</pre>
    </div>
}
